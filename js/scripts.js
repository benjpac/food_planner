var recipeDB = [
  {
    "id" : 1,
    "name" : "quick_colcannon",
    "image" : "http://www.traderjoes.com/images/recipes/353MainImage.jpg",
    "ingredients" : [
      "bacon",
      "potatoe",
      "mixed_greens",
      "butter"
    ],
    "cuisine" : "american",
    "time" : 15,
    "calories" : 800,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "6 slices Uncured Apple Smoked Bacon",
      "1 bag Frozen Mashed Potatoes",
      "1/3 cup Water, plus 2 tablespoons",
      "1/2 bag Mixed Greens",
      "Kerrygold Pure Irish Butter"
    ],
    "directionsList" : [
      "In a large frying pan on medium heat, cook 6 slices of bacon. Set cooked bacon aside on a paper towel-lined plate. Discard all but 1 tablespoon of oil from the pan.",
      "Add bag of frozen mashed potato medallions and 1/3 cup of water. Cook over moderate heat, stirring frequently.",
      "After about 5 minutes, once potatoes begin to soften, add 1/2 bag mixed greens and 2 additional tablespoons of water. Stir then cover to trap steam.",
      "Cook for another 2-3 minutes or so, stirring every so often, until greens soften a bit.",
      "Chop cooled bacon into small pieces then add to pan of potatoes. Serve right away with a pat of butter on top."
    ]
  },
  {
    "id": 2,
    "name" : "green_curry_chickpeas",
    "image" : "http://www.traderjoes.com/images/recipes/411MainImage.jpg",
    "ingredients" : [
      "garbanzo_bean",
      "green_curry_sauce",
      "baby_spinach",
      "red_cherry_tomatoe",
      "quinoa",
      "salt",
      "pepper",
      "tandoori_masala",
      "olive_oil"
    ],
    "cuisine" : "indian",
    "time" : 50,
    "calories" : 1500,
    "vegetarian" : true,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "2 cans Organic Garbanzo Beans",
      "1 Jar Green Curry Sauce",
      "1 bag Organic Baby Spinach",
      "1 pkg Organic Red Cherry Tomatoes",
      "1 cup Organic Quinoa",
      "Sea Salt",
      "Pepper",
      "Olive oil"
    ],
      "directionsList" : [
      "Preheat oven to 400°F",
      "Toss the tomatoes lightly with olive oil, salt and pepper and spread them out into one layer on a sheet pan.",
      "Roast for 15 to 20 minutes, until the tomatoes are soft. While tomatoes are roasting, prepare quinoa.",
      "Warm the curry sauce in a large saucepan over medium heat.",
      "Add the chickpeas and tomatoes and stir to combine. Reduce heat to low and simmer for 15 minutes.",
      "Add the spinach and simmer until spinach is wilted and tender, about 10 minutes. Serve on top of cooked quinoa."
    ]
  },
  {
    "id": 3,
    "name" : "classic_italian_lasagna",
    "image" : "img/lasagna.jpg",
    "ingredients" : [
      "beef",
      "onion",
      "butter",
      "carrot",
      "flour",
      "basil",
      "lasagna_noodle",
      "parmesan_cheese",
      "milk",
      "nutmeg",
      "tomato_paste",
      "olive_oil",
      "celery"
    ],
    "cuisine" : "italian",
    "time" : 30,
    "calories" : 600,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "14.1 oz (400 g) minced beef",
      "1.4 oz (40 g) onion",
      "3.5 oz (100 g) carrots",
      "1.4 oz (40 g) celery ribs",
      "1.4 oz (40 g) tomato paste",
      "14.1 oz (400 ml) water",
      "1.4 oz (40 g) flour",
      "1.4 oz (40 g) butter",
      "26.5 oz (750 ml) milk 3.2%",
      "a pinch of nutmeg powder",
      "4 twigs of fresh basil",
      "2 pinches of salt",
      "1 tablespoon of olive oil",
      "2.8 oz (80 g) parmesan cheese",
      "8 lasagna noodles"
    ],
    "directionsList" : [
      "Preparation of the sauce — Bolognese. Mix tomato paste with some hot water. Dice onion, carrots, and celery. Lay out vegetables and minced beef in a stew pan, pour in the tomato sauce. Add salt and pepper, scald, cover, and simmer on medium heat for 30 minutes. Add finely chopped basil 2-3 minutes before the sauce is done.",
      "Preparation of the sauce — Bechamel. Pour the milk into a saucepan and heat without bringing to boil. The milk should be hot. Melt the butter in a stewpan, add the flour, and fry for 2-3 minutes. Then, gradually pour in the hot milk, stirring to avoid lumps. Continue to stir and simmer, add salt and nutmeg. Once the sauce has thickened, it’s ready. Remove it from heat.",
      "Laying out the lasagna. Grate cheese. Preheat oven to 428°F (220°C). Oil a casserole dish and pour in some Bechamel sauce to cover the bottom, then pour in some Bolognese sauce following the same principle.",
      "Lay out 4 lasagna noodles with overlapping joints. Pour the sauces on top, and sprinkle with cheese. Repeat this process until ingredients are gone.",
      "Put the dish in the preheated oven for 20 minutes. Turn off the oven, cover the dish with foil and leave in a hot oven for another 10 minutes. Enjoy!"
    ]
  },
  {
    "id": 4,
    "name" : "sweet_balls_of_fire",
    "image" : "http://www.traderjoes.com/images/recipes/472MainImage.jpg",
    "ingredients" : [
      "sugar",
      "raspberry_preserves",
      "sweet_chili_sauce",
      "turkey_meatball",
    ],
    "cuisine" : "american",
    "time" : 40,
    "calories" : 1000,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "1/2 cup Sugar",
      "1/2 cup Raspberry Preserves",
      "2 jars Sweet Chili Sauce",
      "2 packages Turkey Meatballs"
    ],
    "directionsList" : [
      "Preheat oven to 350°.",
      "Prepare sauce: In a sauce pan over medium heat, add raspberry preserves and sweet chili sauce. Heat until sauce begins to bubble, about 8-10 minutes, stirring occasionally. Remove from heat.",
      "Place meatballs in a 9x9 baking dish and cover with warm sauce mixture. Place dish in oven and heat for 40 minutes, or until meatballs are heated to 165⩝F and sauce is hot. Alternatively, use a slow cooker to heat meatballs and sauce, about 5-6 hours on low, or 2-4 hours on high until heated through."
    ]
  },
  {
    "id": 5,
    "name" : "biscuits_and_gravy_casserole",
    "image" : "http://www.traderjoes.com/images/recipes/465MainImage.jpg",
    "ingredients" : [
      "ground_pork",
      "flour",
      "milk",
      "olive_oil",
      "cheddar_cheese",
      "pepper",
      "egg",
    ],
    "cuisine" : "american",
    "time" : 35,
    "calories" : 1500,
    "vegetarian" : false,
    "breakfast" : true,
    "lunch": false,
    "dinner" : false,
    "ingredientsList" : [
      "1 package (1 pound) TJ's Ground Pork",
      "1/3 cup All Purpose Flour",
      "3 cups Whole Milk",
      "1/2 teaspoon Salt",
      "1/2 teaspoon Pepper",
      "Extra Virgin Olive Oil Spray, to grease pan",
      "6 TJ's Eggs",
      "1 can TJ's Buttermilk Biscuits",
      "1 cup TJ's Shredded Cheese Blend"
    ],
    "directionsList" : [
      "In a large skillet over medium-high heat, brown the ground pork, breaking it up into pieces with a spoon as it cooks, about 8-10 minutes. When the pork has reached 145ºF and is no longer pink, reduce heat to medium. Sprinkle half of the flour over pork and stir to combine. Add remaining flour and stir to combine. Add one cup of milk to the pan and stir. Continue to add milk one cup at a time as gravy thickens. Cook for another 5-8 minutes to further thicken the gravy.",
      "Preheat oven to 350ºF. Grease a 9x13 pan with olive oil spray and set aside. In a large bowl, add eggs and 21 Seasoning Salute and whisk to combine; set aside. Open the biscuits and tear each biscuit into four pieces. Line the bottom of the greased pan with half of the biscuit dough. Pour egg mixture on top of biscuit dough. Sprinkle cheese evenly atop egg mixture. Pour sausage gravy over egg mixture and top with remaining biscuit dough pieces.",
      "Insert pan in oven and bake for 20 minutes. Cover pan with foil and bake for another 12-15 minutes. Remove from oven and allow to cool slightly before serving."
    ]
  },
  {
    "id" : 6,
    "name" : "sausage_breakfast_sandwich",
    "image" : "img/breakfast_sandwich.jpg",
    "ingredients" : [
      "pork_sausage",
      "egg",
      "american_cheese",
      "english_muffin",
      "butter"
    ],
    "cuisine" : "american",
    "time" : 20,
    "calories" : 383,
    "vegetarian" : false,
    "breakfast" : true,
    "lunch": false,
    "dinner" : false,
    "ingredientsList" : [
      "8 oz pork sausage",
      "4 large eggs",
      "4 slices American cheese",
      "4 English muffins, halved",
      "4 tablespoons salted butter, softened"
    ],
    "directionsList" : [
      "Form sausage into 4 patties. Cook in a large, non-stick sprayed skillet over medium-high heat for 3-4 minutes a side, or until golden brown and crisp. Place sausage patties on a paper towel-lined plate to drain the grease.",
      "Drain fat from skillet then return to stove and turn heat down to medium. Whisk eggs, salt, and pepper in a bowl then pour into the skillet. Cook until top is nearly set but still glossy, then carefully fold eggs over in half. Remove from heat to finish cooking.",
      "In a small bowl, whisk butter until creamy and smooth. Toast the English Muffins.",
      "To assemble: Spread 1 tablespoon of maple butter on English Muffin, both halves. Place 1 egg on the bottom of a English muffin then top with cooked sausage patty and slice of cheese. Microwave for 20-30 seconds to melt cheese then cap with English muffin top. Continue making other sandwiches. Serve immediately."
    ]
  },
  {
    "id": 7,
    "name" : "butter_chicken",
    "image" : "img/butter_chicken.jpg",
    "ingredients" : [
      "onion",
      "garlic",
      "tomato_sauce",
      "heavy_cream",
      "butter",
      "cayenne_pepper",
      "chicken",
      "tandoori_masala",
      "vegetable_oil",
      "salt"
    ],
    "cuisine" : "indian",
    "time" : 60,
    "calories" : 384,
    "vegetarian" : false,
    "breakfast" : true,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "1 cup butter, divided",
      "1 onion, minced",
      "1 tablespoon minced garlic",
      "1 (15 ounce) can tomato sauce",
      "3 cups heavy cream",
      "2 teaspoons salt",
      "1 teaspoon cayenne pepper",
      "1 teaspoon garam masala",
      "1 1/2 pounds skinless, boneless chicken breast, cut into bite-sized chunks",
      "2 tablespoons vegetable oil",
      "2 tablespoons tandoori masala"
    ],
    "directionsList" : [
      "Preparation of the sauce — Bolognese. Mix tomato paste with some hot water. Dice onion, carrots, and celery. Lay out vegetables and minced beef in a stew pan, pour in the tomato sauce. Add salt and pepper, scald, cover, and simmer on medium heat for 30 minutes. Add finely chopped basil 2-3 minutes before the sauce is done.",
      "Preparation of the sauce — Bechamel. Pour the milk into a saucepan and heat without bringing to boil. The milk should be hot. Melt the butter in a stewpan, add the flour, and fry for 2-3 minutes. Then, gradually pour in the hot milk, stirring to avoid lumps. Continue to stir and simmer, add salt and nutmeg. Once the sauce has thickened, it’s ready. Remove it from heat.",
      "Laying out the lasagna. Grate cheese. Preheat oven to 428°F (220°C). Oil a casserole dish and pour in some Bechamel sauce to cover the bottom, then pour in some Bolognese sauce following the same principle.",
      "Lay out 4 lasagna noodles with overlapping joints. Pour the sauces on top, and sprinkle with cheese. Repeat this process until ingredients are gone.",
      "Put the dish in the preheated oven for 20 minutes. Turn off the oven, cover the dish with foil and leave in a hot oven for another 10 minutes. Enjoy!"
    ]
  },
  {
    "id" : 8,
    "name" : "spaghetti_with_meatball",
    "image" : "http://www.traderjoes.com/images/recipes/52MainImage.jpg",
    "ingredients" : [
      "spaghetti",
      "meatballs",
      "olive_oil",
      "marinara",
      "parmesan_cheese",
      "salt",
      "pepper"
    ],
    "cuisine" : "italian",
    "time" : 30,
    "calories" : 1200,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "1/2 Spaghetti",
      "1/2 package meatballs",
      "Olive Oil",
      "1 tablespoon parmesan_cheese",
      "1/4 teaspoon of salt",
      "1/4 teaspoon of pepper"
    ],
    "directionsList" : [
      "Cook the spaghetti.",
      "Season with salt and pepper, place in a microwave safe dish and add about an inch of water to the bottom of the dish.",
      "Cover dish with cling wrap and microwave on high for 10-14 minutes. Allow to cool enough to handle before unwrapping.",
      "Use a table fork to scrape squash from top to bottom to separate flesh into strands of spaghetti.",
      "Prepare Meatball Marinara: Place meatballs in large skillet.",
      "Once warmed through, add marinara sauce and cooked spaghetti.",
      "Toss to cover and heat through; add Parmesan, salt and pepper, to taste. Serve right away."
    ]
  },
  {
    "id" : 9,
    "name" : "bbq_chicken_nachos",
    "image" : "http://www.traderjoes.com/images/recipes/172MainImage.jpg",
    "ingredients" : [
      "tortilla_chips",
      "pulled_chicken_breast",
      "barbecue_sauce",
      "cheddar_cheese",
      "roasted_corn",
      "onion",
      "ranch_dressing",
      "cilantro"
    ],
    "cuisine" : "mexican",
    "time" : 15,
    "calories" : 1000,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "ingredientsList" : [
      "1/2 bag Salted Tortilla Chips",
      "1 package Pulled Chicken Breast w/BBQ Sauce",
      "3 Tbsp Bold & Smoky Kansas City Style Barbecue Sauce",
      "1 package Shredded Pepper Jack Cheese Blend",
      "1/2 bag Frozen Roasted Corn",
      "1/2 cup Red Onion, diced",
      "3 Tbsp Parmesan Ranch Dressing",
      "3 Tbsp fresh Cilantro, chopped"
    ],
    "directionsList" : [
      "Preheat oven to 350 degrees.",
      "Spread an even layer of tortilla chips in a large oven-safe dish. In the following order: add chicken, BBQ sauce, cheese, roasted corn and onion.",
      "Bake for 10 to 15 minutes or until cheese starts to bubble.",
      "Remove from oven, drizzle with ranch dressing and garnish with fresh cilantro."
    ]
  }
]

// gather all ingredients from recipeDB and display as list with no duplicates, sort
function parseRecipes(recipeDB) {
  var recipeIngredients = [];
  recipeDB.forEach(function(recipe) {
    recipe.ingredients.forEach(function(ingredient) {
      if (recipeIngredients.indexOf(ingredient) === -1)
      {
        recipeIngredients.push(ingredient);
      }
    })
  })
  return recipeIngredients.sort();
}

// compare user checked ingredients with recipe ingredients
function matchIngredients(recipe, checkedIngredients) {
  var matchCount = 0;
  checkedIngredients.forEach(function(checkedIngredient) {
    recipe.ingredients.forEach(function(recipeIngredient) {
      if (checkedIngredient === recipeIngredient)
      {
        matchCount++;
      }
    })
  })
  return matchCount;
}

// find partial recipe match
function partialMatch(recipe, matchCount) {
  if (matchCount >= (recipe.ingredients.length*(0.5)))
  {
    return recipe;
  }
}

// find full match
function fullMatch(recipe, matchCount) {
  if (matchCount === recipe.ingredients.length)
  {
    return recipe;
  }
}

// remove underscores and caps first letter of each word in string
function formatForFrontend(string) {
  var formattedArray = [];
  var replaceUnderScore = string.replace(/_/g," ").split(" ");
  replaceUnderScore.forEach(function(word) {
    formattedArray.push(word.charAt(0).toUpperCase() + word.slice(1));
  })
  return formattedArray.join(" ");
}

// replaces spaces in string to underscores and change to lowercase
function formatForBackend(string) {
  return string.replace(/ /g,"_").toLowerCase();
}

// create formatted string on parsed recipe meal time
function mealString(breakfast, lunch, dinner) {
  var meals = "";
  if (breakfast)
  {
    meals += "Breakfast ";
  }
  if (lunch)
  {
    meals += "Lunch ";
  }
  if (dinner)
  {
    meals += "Dinner ";
  }
  return meals;
}

// create all HTML for recipe
function createMatchedRecipeCard(recipe, idAppend, div) {
  var id = recipe.name+'_id'+recipe.id+idAppend;
  var nameFormatted = formatForFrontend(recipe.name);
  console.log(div, id);
  $(div).append(
    '<div class="col-6 col-lg-4">'+
      '<div class="card">'+
        '<div id='+id+'>'+
          '<img class="card-img-top img-fluid" src='+recipe.image+'>'+
          '<h6 class="card-title text-center mt-2">'+nameFormatted+'</h6>'+
        '</div>'+
      '</div>'+
    '</div>'
  )
  var cuisineFormatted = formatForFrontend(recipe.cuisine);
  var mealsFormatted = mealString(recipe.breakfast, recipe.lunch, recipe.dinner);
  $("#recipe-full").append(
    '<div id='+id+'_full>'+
      '<div class="row">'+
        '<div class="col-sm-1 offset-sm-11">'+
          '<img class="close-recipe mt-3" src="img/cross.png">'+
        '</div>'+
      '</div>'+
      '<div class="recipe-head text-center">'+
       '<h1>'+nameFormatted+'</h1>'+
       '<p class="lead">'+
       '</p>'+
       '<hr>'+
       '<div class="row">'+
         '<div class="col-sm-3"><p>Cuisine: '+cuisineFormatted+'</p></div>'+
         '<div class="col-sm-3"><p>Meal: '+mealsFormatted+'</p></div>'+
         '<div class="col-sm-3"><p>Time: '+recipe.time+' minutes</p></div>'+
         '<div class="col-sm-3"><p>Calories: '+recipe.calories+'</p></div>'+
       '</div>'+
       '<hr>'+
       '<img class="img-fluid" src='+recipe.image+' alt="">'+
       '<hr>'+
      '</div>'+
      '<div class="row mt-4" >'+
       '<div class="col-lg-6 pl-5">'+
         '<div class="recipe-ingredients">'+
           '<h4>Ingredients: </h4>'+
           '<ul id='+id+'_ingredients>'+

           '</ul>'+
         '</div>'+
       '</div>'+
       '<div class="col-lg-6">'+
         '<div class="recipe-directions">'+
           '<h4>Directions: </h4>'+
           '<ol id='+id+'_directions>'+

           '</ol>'+
         '</div>'+
       '</div>'+
     '</div>'+
    '</div>'
  )
  recipe.ingredientsList.forEach(function(line) {
    $('#'+id+'_ingredients').append('<li>'+line+'</li>');
  })
  recipe.directionsList.forEach(function(line) {
    $('#'+id+'_directions').append('<li>'+line+'</li>');
  })

  $('#'+id+'_full').css("display", "none");

  $('#'+id+'_full .close-recipe').click(function() {
    $('#'+id+'_full').hide();
    $("#main-content").show();
    console.log("on click close "+div + " with id " +id);
  })
  $('#'+id).click(function() {
    $("#main-content").hide();
    $('#'+id+'_full').show();
    console.log("on click open "+div + " with id " +id);
  })
}

$(document).ready(function() {
  var recipeIngredients = parseRecipes(recipeDB);
  recipeIngredients.forEach(function(myIngredient)
  {
    var frontendIngredient = formatForFrontend(myIngredient);
    $("#my-ingredients").append(
      '<div class="form-check">'+
        '<label class="form-check-label">'+
          '<input class="form-check-input" type="checkbox" name="checkbox" value=' + myIngredient + '> '+
          frontendIngredient+
        '</label>'+
      '</div>'
    )
  })
  recipeDB.forEach(function(recipe) {
    createMatchedRecipeCard(recipe, "_a", "#all-recipes");
  });


  var checkedIngredients = [];
  var fullMatches = [];
  var partialMatches = [];
  $("#my-ingredients input[name='checkbox']").click(function() {
    $("#all-recipes").empty();

    if (this.checked)
    {
      checkedIngredients.push($(this).val());
    }
    else
    {
      var ingredientIndex = checkedIngredients.indexOf($(this).val());
      if (ingredientIndex > -1)
      {
        checkedIngredients.splice(ingredientIndex, 1);
      }
    }
    recipeDB.forEach(function(recipe) {
      var fullMatchRecipe = fullMatch(recipe, matchIngredients(recipe, checkedIngredients));
      if (fullMatchRecipe !== undefined)
      {
        console.log("full match index: " + fullMatches.indexOf(fullMatchRecipe))
        if (fullMatches.indexOf(fullMatchRecipe) === -1)
        {
          $('#'+fullMatchRecipe.name+'_id'+fullMatchRecipe.id+'_p').parents().eq(1).hide();
          fullMatches.push(fullMatchRecipe);
          $(".instructions").hide();
          console.log("full matches: ");
          console.log(fullMatchRecipe);
          $("#matched-recipes h3").show();
          createMatchedRecipeCard(fullMatchRecipe, "", "#matched-recipes");
        }
      }
      var partialMatchedRecipe = partialMatch(recipe, matchIngredients(recipe, checkedIngredients));
      if (partialMatchedRecipe !== undefined)
      {
        console.log("partial match index: " + partialMatches.indexOf(partialMatchedRecipe))
        if (partialMatches.indexOf(partialMatchedRecipe) === -1)
        {
          partialMatches.push(partialMatchedRecipe);
          console.log("partial matches: ");
          console.log(partialMatches);
          $(".instructions").hide();
          $("#partial-matched-recipes h3").show();
          createMatchedRecipeCard(partialMatchedRecipe, "_p", "#partial-matched-recipes");
        }
      }
    })
    console.log("checkedIngredients array: " + checkedIngredients);
  })
})
