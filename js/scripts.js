var recipeDB = [
  {
    "id" : 1,
    "name" : "sausage_breakfast_sandwich",
    "image" : "http://www.twopeasandtheirpod.com/wp-content/uploads/2013/12/Sausage-Egg-and-Cheese-Sandwich-with-Maple-Butter-3.jpg",
    "ingredients" : [
      "pork_sausage",
      "egg",
      "american_cheese",
      "english_muffin",
      "butter"
    ],
    "cuisine" : "american",
    "time" : 20,
    "calories" : 383,
    "vegetarian" : false,
    "breakfast" : true,
    "lunch": false,
    "dinner" : false,
    "ingredientsList" : [
      "8 oz pork sausage",
      "4 large eggs",
      "4 slices American cheese",
      "4 English muffins, halved",
      "4 tablespoons salted butter, softened"
    ],
    "directionsList" : [
      "Form sausage into 4 patties. Cook in a large, non-stick sprayed skillet over medium-high heat for 3-4 minutes a side, or until golden brown and crisp. Place sausage patties on a paper towel-lined plate to drain the grease.",
      "Drain fat from skillet then return to stove and turn heat down to medium. Whisk eggs, salt, and pepper in a bowl then pour into the skillet. Cook until top is nearly set but still glossy, then carefully fold eggs over in half. Remove from heat to finish cooking.",
      "In a small bowl, whisk butter until creamy and smooth. Toast the English Muffins.",
      "To assemble: Spread 1 tablespoon of maple butter on English Muffin, both halves. Place 1 egg on the bottom of a English muffin then top with cooked sausage patty and slice of cheese. Microwave for 20-30 seconds to melt cheese then cap with English muffin top. Continue making other sandwiches. Serve immediately."
    ]
  },
  {
    "id": 2,
    "name" : "butter_chicken",
    "image" : "http://noshingwiththenolands.com/wp-content/uploads/2016/03/Slow-Cooker-Butter-Chicken-square-Custom.jpg",
    "ingredients" : [
      "onion",
      "garlic",
      "tomato_sauce",
      "heavy_cream",
      "butter",
      "cayenne_pepper",
      "chicken",
      "tandoori_masala",
      "oil_-_vegetable",
      "salt"
    ],
    "cuisine" : "indian",
    "time" : 60,
    "calories" : 384,
    "vegetarian" : false,
    "breakfast" : true,
    "lunch": true,
    "dinner" : true,
    "directions" : [
      "INGREDIENTS: 1 cup butter, divided",
      "1 onion, minced",
      "1 tablespoon minced garlic",
      "1 (15 ounce) can tomato sauce",
      "3 cups heavy cream",
      "2 teaspoons salt",
      "1 teaspoon cayenne pepper",
      "1 teaspoon garam masala",
      "1 1/2 pounds skinless, boneless chicken breast, cut into bite-sized chunks",
      "2 tablespoons vegetable oil",
      "2 tablespoons tandoori masala",
      "DIRECTIONS: 1. Preparation of the sauce — Bolognese. Mix tomato paste with some hot water. Dice onion, carrots, and celery. Lay out vegetables and minced beef in a stew pan, pour in the tomato sauce. Add salt and pepper, scald, cover, and simmer on medium heat for 30 minutes. Add finely chopped basil 2-3 minutes before the sauce is done.",
      "2. Preparation of the sauce — Bechamel. Pour the milk into a saucepan and heat without bringing to boil. The milk should be hot. Melt the butter in a stewpan, add the flour, and fry for 2-3 minutes. Then, gradually pour in the hot milk, stirring to avoid lumps. Continue to stir and simmer, add salt and nutmeg. Once the sauce has thickened, it’s ready. Remove it from heat.",
      "3. Laying out the lasagna. Grate cheese. Preheat oven to 428°F (220°C). Oil a casserole dish and pour in some Bechamel sauce to cover the bottom, then pour in some Bolognese sauce following the same principle.",
      "4. Lay out 4 lasagna noodles with overlapping joints. Pour the sauces on top, and sprinkle with cheese. Repeat this process until ingredients are gone.",
      "5. Put the dish in the preheated oven for 20 minutes. Turn off the oven, cover the dish with foil and leave in a hot oven for another 10 minutes. Enjoy!"
    ]
  },
  {
    "id": 3,
    "name" : "classic_italian_lasagna",
    "image" : "http://www.forgottothink.com/wp-content/uploads/2016/06/italian-dishes-6.jpg",
    "ingredients" : [
      "minced_beef",
      "onion",
      "butter",
      "carrots",
      "butter",
      "wheat_flour",
      "basil",
      "lasagna_noodles",
      "parmesan",
    ],
    "cuisine" : "italian",
    "time" : 30,
    "calories" : 600,
    "vegetarian" : false,
    "breakfast" : false,
    "lunch": true,
    "dinner" : true,
    "directions" : [
      "INGREDIENTS: 14.1 oz (400 g) minced beef",
      "1.4 oz (40 g) onion",
      "3.5 oz (100 g) carrots",
      "1.4 oz (40 g) celery ribs",
      "1.4 oz (40 g) tomato paste",
      "14.1 oz (400 ml) water",
      "1.4 oz (40 g) wheat flour",
      "1.4 oz (40 g) butter",
      "26.5 oz (750 ml) milk 3.2%",
      "a pinch of nutmeg powder",
      "4 twigs of fresh basil",
      "2 pinches of salt",
      "1 tablespoon of olive oil",
      "2.8 oz (80 g) parmesan",
      "8 lasagna noodles",
      "DIRECTIONS: 1. Preparation of the sauce — Bolognese. Mix tomato paste with some hot water. Dice onion, carrots, and celery. Lay out vegetables and minced beef in a stew pan, pour in the tomato sauce. Add salt and pepper, scald, cover, and simmer on medium heat for 30 minutes. Add finely chopped basil 2-3 minutes before the sauce is done.",
      "2. Preparation of the sauce — Bechamel. Pour the milk into a saucepan and heat without bringing to boil. The milk should be hot. Melt the butter in a stewpan, add the flour, and fry for 2-3 minutes. Then, gradually pour in the hot milk, stirring to avoid lumps. Continue to stir and simmer, add salt and nutmeg. Once the sauce has thickened, it’s ready. Remove it from heat.",
      "3. Laying out the lasagna. Grate cheese. Preheat oven to 428°F (220°C). Oil a casserole dish and pour in some Bechamel sauce to cover the bottom, then pour in some Bolognese sauce following the same principle.",
      "4. Lay out 4 lasagna noodles with overlapping joints. Pour the sauces on top, and sprinkle with cheese. Repeat this process until ingredients are gone.",
      "5. Put the dish in the preheated oven for 20 minutes. Turn off the oven, cover the dish with foil and leave in a hot oven for another 10 minutes. Enjoy!"
    ]
  }
]

// find recipes that user has ingredients for
function matchedIngredients(recipeIngredients, userIngredients) {
  var matchCount = 0;
  userIngredients.forEach(function(userIngredient) {
    recipeIngredients.forEach(function(recipeIngredient) {
      // if (userIngredient === recipeIngredient) {
        if (userIngredient.includes(recipeIngredient)) {
        matchCount++;
      }
    })
  })
  // console.log("match count:" +matchCount);
  if (matchCount === recipeIngredients.length) {
    return true;
  }
  else
  {
    return false;
  }
}

// function noMatchArray(array) {
//
// }

// gather all ingredients from recipeDB and display as list with no duplicates, sort
function parseRecipes(recipeDB) {
  var recipeIngredients = [];
  recipeDB.forEach(function(recipe) {
    recipe.ingredients.forEach(function(ingredient) {
      if (recipeIngredients.indexOf(ingredient) === -1)
      {
        recipeIngredients.push(ingredient);
      }
    })
  })
  return recipeIngredients.sort();
}

// remove underscores and caps first letter of each word in string
function formatForFrontend(string) {
  var formattedArray = [];
  var replaceUnderScore = string.replace(/_/g," ").split(" ");
  replaceUnderScore.forEach(function(word) {
    formattedArray.push(word.charAt(0).toUpperCase() + word.slice(1));
  })
  return formattedArray.join(" ");
}

// replaces spaces in string to underscores and change to lowercase
function formatForBackend(string) {
  return string.replace(/ /g,"_").toLowerCase();
}

// create formatted string on parsed recipe meal time
function mealString(breakfast, lunch, dinner) {
  var meals = "";
  if (breakfast)
  {
    meals += "Breakfast ";
  }
  if (lunch)
  {
    meals += "Lunch ";
  }
  if (dinner)
  {
    meals += "Dinner ";
  }
  return meals;
}

$(document).ready(function() {
  var recipeIngredients = parseRecipes(recipeDB);
  recipeIngredients.forEach(function(myIngredient)
  {
    var frontendIngredient = formatForFrontend(myIngredient);
    $("#my-ingredients").append(
      '<div class="form-check">'+
        '<label class="form-check-label">'+
          '<input class="form-check-input" type="checkbox" name="checkbox" value=' + myIngredient + '> '+
          frontendIngredient+
        '</label>'+
      '</div>'
    )
  })

  var checkedIngredient = [];
  $("#my-ingredients input[name='checkbox']").click(function() {
    // add logic to pop() when removing and push() when adding
    $("#matched-recipes").empty();
    if (this.checked)
    {
      checkedIngredient.push($(this).val());
    }
    else
    {
      var ingredientIndex = checkedIngredient.indexOf($(this).val());
      if (ingredientIndex > -1)
      {
        checkedIngredient.splice(ingredientIndex, 1);
      }
    }
    recipeDB.forEach(function(recipe) {
      var matchedRecipes = [];
      var matchedRecipe = matchedIngredients(recipe.ingredients, checkedIngredient)
      if (matchedRecipe)
      {
        var nameFormatted = formatForFrontend(recipe.name);
        var recipeID = recipe.name+'_id'+recipe.id;
        matchedRecipes.push(recipe)
        $("#matched-recipes").append(
          '<div class="col-6 col-lg-4">'+
            '<div class="card">'+
              '<div id='+recipeID+'>'+
                '<img class="card-img-top img-fluid" src='+recipe.image+'>'+
                '<h6 class="card-title text-center mt-2">'+nameFormatted+'</h6>'+
              '</div>'+
            '</div>'+
          '</div>'
        )
      }

      $("#"+recipeID).click(function() {
       $("#main-content").hide();
       var cuisineFormatted = formatForFrontend(recipe.cuisine);
       var mealsFormatted = mealString(recipe.breakfast, recipe.lunch, recipe.dinner);
       $("#recipe-full").append(
         '<div class="recipe-head text-center">'+
          '<h1>'+nameFormatted+'</h1>'+
          '<p class="lead">'+
          '</p>'+
          '<hr>'+
          '<div class="row">'+
            '<div class="col-sm-3"><p>Cuisine: '+cuisineFormatted+'</p></div>'+
            '<div class="col-sm-3"><p>Meal: '+mealsFormatted+'</p></div>'+
            '<div class="col-sm-3"><p>Time: '+recipe.time+' minutes</p></div>'+
            '<div class="col-sm-3"><p>Calories: '+recipe.calories+'</p></div>'+
          '</div>'+
          '<hr>'+
          '<img class="img-fluid" src='+recipe.image+' alt="">'+
          '<hr>'+
        '</div>'+
        '<div class="row mt-4" >'+
          '<div class="col-lg-6 pl-5">'+
            '<div class="recipe-ingredients">'+
              '<h4>Ingredients: </h4>'+
              '<ul id='+recipeID+'_ingredients>'+

              '</ul>'+
            '</div>'+
          '</div>'+
          '<div class="col-lg-6">'+
            '<div class="recipe-directions">'+
              '<h4>Directions: </h4>'+
              '<ol id='+recipeID+'_directions>'+

              '</ol>'+
            '</div>'+
          '</div>'+
        '</div>'
        );
        recipe.ingredientsList.forEach(function(line) {
          $('#'+recipeID+'_ingredients').append('<li>'+line+'</li>');
        });
        recipe.directionsList.forEach(function(line) {
          $('#'+recipeID+'_directions').append('<li>'+line+'</li>');
        });
      });
    });
    console.log("checkedIngredient array: " + checkedIngredient);
  });
});
